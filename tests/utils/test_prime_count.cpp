#include "cado.h" // IWYU pragma: keep

#include <vector>

#include "fmt/base.h"

#include "cado_mp_conversions.hpp"
#include "cxx_mpz.hpp"
#include "misc.h"

int main()
{
    /* https://oeis.org/A007053/b007053.txt */
    std::vector<cxx_mpz> b7053 {
        "0"_mpz,
        "1"_mpz,
        "2"_mpz,
        "4"_mpz,
        "6"_mpz,
        "11"_mpz,
        "18"_mpz,
        "31"_mpz,
        "54"_mpz,
        "97"_mpz,
        "172"_mpz,
        "309"_mpz,
        "564"_mpz,
        "1028"_mpz,
        "1900"_mpz,
        "3512"_mpz,
        "6542"_mpz,
        "12251"_mpz,
        "23000"_mpz,
        "43390"_mpz,
        "82025"_mpz,
        "155611"_mpz,
        "295947"_mpz,
        "564163"_mpz,
        "1077871"_mpz,
        "2063689"_mpz,
        "3957809"_mpz,
        "7603553"_mpz,
        "14630843"_mpz,
        "28192750"_mpz,
        "54400028"_mpz,
        "105097565"_mpz,
        "203280221"_mpz,
        "393615806"_mpz,
        "762939111"_mpz,
        "1480206279"_mpz,
        "2874398515"_mpz,
        "5586502348"_mpz,
        "10866266172"_mpz,
        "21151907950"_mpz,
        "41203088796"_mpz,
        "80316571436"_mpz,
        "156661034233"_mpz,
        "305761713237"_mpz,
        "597116381732"_mpz,
        "1166746786182"_mpz,
        "2280998753949"_mpz,
        "4461632979717"_mpz,
        "8731188863470"_mpz,
        "17094432576778"_mpz,
        "33483379603407"_mpz,
        "65612899915304"_mpz,
        "128625503610475"_mpz,
        "252252704148404"_mpz,
        "494890204904784"_mpz,
        "971269945245201"_mpz,
        "1906879381028850"_mpz,
        "3745011184713964"_mpz,
        "7357400267843990"_mpz,
        "14458792895301660"_mpz,
        "28423094496953330"_mpz,
        "55890484045084135"_mpz,
        "109932807585469973"_mpz,
        "216289611853439384"_mpz,
        "425656284035217743"_mpz,
        "837903145466607212"_mpz,
        "1649819700464785589"_mpz,
        "3249254387052557215"_mpz,
        "6400771597544937806"_mpz,
        "12611864618760352880"_mpz,
        "24855455363362685793"_mpz,
        "48995571600129458363"_mpz,
        "96601075195075186855"_mpz,
        "190499823401327905601"_mpz,
        "375744164937699609596"_mpz,
        "741263521140740113483"_mpz,
        "1462626667154509638735"_mpz,
        "2886507381056867953916"_mpz,
        "5697549648954257752872"_mpz,
        "11248065615133675809379"_mpz,
        "22209558889635384205844"_mpz,
        "43860397052947409356492"_mpz,
        "86631124695994360074872"_mpz,
        "171136408646923240987028"_mpz,
        "338124238545210097236684"_mpz,
        "668150111666935905701562"_mpz,
        "1320486952377516565496055"_mpz,
        "2610087356951889016077639"_mpz,
        "5159830247726102115466054"_mpz,
        "10201730804263125133012340"_mpz,
        "20172933541156002700963336"_mpz,
        "39895115987049029184882256"_mpz,
        "78908656317357166866404346"_mpz,
    };
    for(size_t i = 1 ; i < b7053.size() ; i++) {
        const auto b = b7053[i];
        const auto c = prime_pi_2exp(i);
        const auto r = cado_math_aux::mpz_get<double>(b) / c - 1;
        int rexp;
        if (std::frexp(r, &rexp) == 0) rexp = INT_MIN;
        fmt::print("n={} b={} c={} r={}\n",
                i, b7053[i], prime_pi_2exp(i), rexp);
        /* the OSX math library is apparently getting it wrong for expint
         */
        ASSERT_ALWAYS(rexp <= -10);
    }
}

